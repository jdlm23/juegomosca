<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Juego de la Mosca</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body, html {
      height: 100%;
      overflow: hidden;
      font-family: 'Press Start 2P', cursive;
    }

    #game {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: url('jdlm_fondo.png') no-repeat center center;
      background-size: cover;
    }

    #fly {
      position: absolute;
      width: 70px;
      height: 70px;
      background: url('jdlm_mosca.png') no-repeat center;
      background-size: contain;
    }

    .projectile {
      position: absolute;
      width: 50px;
      height: 20px;
      background: url('jdlm_proyectil.png') no-repeat center;
      background-size: contain;
    }

    #startText, #timer, #gameOverText {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 16px;
      text-shadow: 2px 2px 2px black;
      z-index: 10;
    }

    #startText {
      top: 50%;
      transform: translate(-50%, -50%);
      opacity: 1;
      transition: opacity 1s;
    }

    #gameOverScreen {
      position: absolute;
      width: 100%;
      height: 100%;
      background: black;
      opacity: 0;
      color: white;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      transition: opacity 2s;
      z-index: 20;
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="fly"></div>
    <div id="timer">00:00</div>
    <div id="startText">PULSA PARA EMPEZAR</div>
    <div id="gameOverScreen">
      <div id="gameOverText"></div>
    </div>
    <audio id="bgm" src="jdlm_musica.mp3" loop></audio>
    <audio id="deathSound" src="jdlm_derrota.mp3"></audio>
  </div>

<script>
  const fly = document.getElementById("fly");
  const game = document.getElementById("game");
  const timerText = document.getElementById("timer");
  const startText = document.getElementById("startText");
  const gameOverScreen = document.getElementById("gameOverScreen");
  const gameOverText = document.getElementById("gameOverText");
  const bgm = document.getElementById("bgm");
  const deathSound = document.getElementById("deathSound");

  let gameStarted = false;
  let startTime;
  let timerInterval;
  let spawnTimeout;
  let flyX = 100, flyY = 100;

  let projectileSpeed = 10;
  let projectileInterval = 1000;
  let difficultyInterval;

  function updateTimer() {
    const now = Date.now();
    const diff = Math.floor((now - startTime) / 1000);
    const minutes = String(Math.floor(diff / 60)).padStart(2, '0');
    const seconds = String(diff % 60).padStart(2, '0');
    timerText.textContent = `${minutes}:${seconds}`;
  }

  function spawnProjectile() {
    const projectile = document.createElement("div");
    projectile.className = "projectile";
    projectile.style.top = `${Math.random() * (window.innerHeight - 20)}px`;
    projectile.style.left = `${window.innerWidth}px`;
    game.appendChild(projectile);

    const interval = setInterval(() => {
      const rect = projectile.getBoundingClientRect();
      if (rect.left < -50) {
        clearInterval(interval);
        projectile.remove();
      } else {
        projectile.style.left = `${rect.left - projectileSpeed}px`;

        const flyRect = fly.getBoundingClientRect();
        if (
          rect.left < flyRect.right &&
          rect.right > flyRect.left &&
          rect.top < flyRect.bottom &&
          rect.bottom > flyRect.top
        ) {
          gameOver();
          clearInterval(interval);
          projectile.remove();
        }
      }
    }, 16);

    spawnTimeout = setTimeout(spawnProjectile, projectileInterval);
  }

  function gameOver() {
    clearInterval(timerInterval);
    clearTimeout(spawnTimeout);
    clearInterval(difficultyInterval);
    bgm.pause();
    deathSound.play();
    gameOverText.textContent = `HAS AGUANTADO ${timerText.textContent}`;
    gameOverScreen.style.opacity = 1;
  }

  function startGame() {
    gameStarted = true;
    startText.style.opacity = 0;
    bgm.play();
    startTime = Date.now();
    timerInterval = setInterval(updateTimer, 1000);
    spawnProjectile();

    difficultyInterval = setInterval(() => {
      projectileSpeed += 1;
      if (projectileInterval > 300) {
        projectileInterval -= 105;
      }

      clearTimeout(spawnTimeout);
      spawnTimeout = setTimeout(spawnProjectile, projectileInterval);

      console.log("Velocidad proyectil:", projectileSpeed);
      console.log("Intervalo de apariciÃ³n:", projectileInterval);
    }, 20000);
  }

  document.addEventListener("mousemove", (e) => {
    if (gameStarted) {
      fly.style.left = `${e.clientX - 50}px`;
      fly.style.top = `${e.clientY - 50}px`;
    }
  });

  document.addEventListener("click", () => {
    if (!gameStarted) startGame();
  });
 </script>
</body>

</html>
